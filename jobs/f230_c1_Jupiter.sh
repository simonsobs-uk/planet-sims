#!/usr/bin/env bash

while true; do
    date >&2
    free -h >&2
    sleep 60
done &

echo '========================================================================' >&2
echo "HTCondor config summary:" >&2
echo '------------------------------------------------------------------------' >&2
condor_config_val -summary >&2

echo '========================================================================' >&2
echo "Current environment:" >&2
echo '------------------------------------------------------------------------' >&2
env >&2

echo '========================================================================' >&2
echo "CPU info:" >&2
echo '------------------------------------------------------------------------' >&2
# cat /proc/cpuinfo
lscpu >&2

echo '========================================================================' >&2
echo "Memory info:" >&2
echo '------------------------------------------------------------------------' >&2
cat /proc/meminfo >&2
# lsmem

echo '========================================================================' >&2
echo 'Unpacking environment...' >&2
tar -xzf pmpm-20230718-Linux-x86_64-OpenMPI.tar.gz -C /tmp >&2
. /tmp/pmpm-20230718/bin/activate /tmp/pmpm-20230718 >&2
echo '------------------------------------------------------------------------' >&2
echo 'Environment is available at:' >&2
which python >&2

echo '========================================================================' >&2
echo 'Running run_planet_sims_pipeline.py...' >&2
command time -v ./run_planet_sims_pipeline.py f230 c1 Jupiter
